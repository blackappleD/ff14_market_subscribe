(()=>{"use strict";var e={104:(e,o,t)=>{var s=t(130),r=t(768);const a={id:"app"};function n(e,o,t,s,n,l){const i=(0,r.g2)("router-view");return(0,r.uX)(),(0,r.CE)("div",a,[(0,r.bF)(i)])}const l=(0,r.pM)({name:"App"});var i=t(241);const u=(0,i.A)(l,[["render",n]]),d=u;var c=t(387),m=t(232);const p={class:"home-container"},h={class:"nav-bar"},g={class:"content"},w={class:"button-group"},v={key:1,class:"user-profile"},k={class:"user-info"},f={class:"username"},b={class:"email"};function L(e,o,t,s,a,n){const l=(0,r.g2)("router-link");return(0,r.uX)(),(0,r.CE)("div",p,[(0,r.Lk)("div",h,[(0,r.bF)(l,{to:"/",class:"nav-item active"},{default:(0,r.k6)((()=>o[3]||(o[3]=[(0,r.eW)("首页")]))),_:1}),(0,r.bF)(l,{to:"/subscribe",class:"nav-item"},{default:(0,r.k6)((()=>o[4]||(o[4]=[(0,r.eW)("物品订阅")]))),_:1})]),(0,r.Lk)("div",g,[e.isLoggedIn?((0,r.uX)(),(0,r.CE)("div",v,[o[6]||(o[6]=(0,r.Lk)("div",{class:"avatar"},[(0,r.Lk)("span",{class:"avatar-text"},"头像")],-1)),(0,r.Lk)("div",k,[(0,r.Lk)("h2",f,(0,m.v_)(e.username),1),(0,r.Lk)("p",b,(0,m.v_)(e.email),1),(0,r.Lk)("button",{class:"logout-btn",onClick:o[2]||(o[2]=(...o)=>e.handleLogout&&e.handleLogout(...o))},"退出登录")])])):((0,r.uX)(),(0,r.CE)(r.FK,{key:0},[o[5]||(o[5]=(0,r.Lk)("h1",{class:"title"},"首页",-1)),(0,r.Lk)("div",w,[(0,r.Lk)("button",{class:"login-btn",onClick:o[0]||(o[0]=(...o)=>e.goToLogin&&e.goToLogin(...o))},"登录"),(0,r.Lk)("button",{class:"register-btn",onClick:o[1]||(o[1]=(...o)=>e.goToRegister&&e.goToRegister(...o))},"注册")])],64))])])}var y=t(782),I=t(373);const S={namespaced:!0,state:{token:localStorage.getItem("token"),isLoggedIn:!!localStorage.getItem("token"),username:localStorage.getItem("username"),email:localStorage.getItem("email")},mutations:{setToken(e,o){try{if("string"!==typeof o)return void console.error("Invalid token type:",typeof o);e.token=o,localStorage.setItem("token",o),D.defaults.headers.common["Authorization"]=`Bearer ${o}`}catch(t){console.error("设置 token 失败:",t)}},setUser(e,o){o&&(e.username=o.userName,e.email=o.email,localStorage.setItem("username",o.userName),localStorage.setItem("email",o.email))},setLoggedIn(e,o){e.isLoggedIn=o},logout(e){e.token=null,e.isLoggedIn=!1,e.username=null,e.email=null,localStorage.removeItem("token"),localStorage.removeItem("username"),localStorage.removeItem("email"),delete D.defaults.headers.common["Authorization"]}}},C=S,R=(0,y.y$)({modules:{auth:C}}),_=I.A.create({baseURL:"https://pangkazhuzhu.top:32323",timeout:1e4,withCredentials:!0,headers:{"Content-Type":"application/json"}});_.interceptors.request.use((e=>{const o=R.state.auth.token;if(o&&e.headers)try{e.headers.Authorization=`Bearer ${o}`}catch(t){console.error("设置请求头失败:",t)}return e.url&&!e.url.startsWith("http")&&(e.url=`https://pangkazhuzhu.top:32323${e.url}`),e}),(e=>Promise.reject(e))),_.interceptors.response.use((e=>(console.log("Response:",e),e)),(e=>(console.error("Request error:",e),401===e.response?.status&&(R.commit("auth/logout"),Te.push("/login")),Promise.reject(e))));const D=_,F=(0,r.pM)({name:"HomePage",setup(){const e=(0,c.rd)(),o=(0,y.Pj)(),t=(0,r.EW)((()=>o.state.auth.isLoggedIn)),s=(0,r.EW)((()=>o.state.auth.username)),a=(0,r.EW)((()=>o.state.auth.email)),n=()=>{e.push("/login")},l=()=>{e.push("/register")},i=async()=>{try{await D.post("/ff14/user/logout"),o.commit("auth/logout"),delete D.defaults.headers.common["Authorization"],e.push("/login")}catch(t){console.error("退出登录失败:",t)}};return{isLoggedIn:t,username:s,email:a,goToLogin:n,goToRegister:l,handleLogout:i}}}),W=(0,i.A)(F,[["render",L],["__scopeId","data-v-8675a546"]]),E=W,U={class:"subscribe-container"},X={class:"nav-bar"},A={class:"content"},T={class:"subscription-form"},V={class:"input-row"},j={class:"server-column"},M=["onUpdate:modelValue","onInput","onFocus","onBlur"],O={key:0,class:"dropdown-menu"},J=["onMousedown"],P={class:"items-column"},x={class:"item-wrapper"},K=["onUpdate:modelValue","onInput","onFocus","onBlur"],q={key:0,class:"dropdown-menu"},z=["onMousedown"],B=["onUpdate:modelValue"],$=["onClick"],N={class:"item-input-wrapper"},G=["onUpdate:modelValue","onInput","onFocus","onBlur"],Q={key:0,class:"dropdown-menu"},H=["onMousedown"],Y=["onUpdate:modelValue"],Z=["onClick"],ee=["onClick"],oe={class:"server-add-row"},te={class:"submit-row"};function se(e,o,t,a,n,l){const i=(0,r.g2)("router-link");return(0,r.uX)(),(0,r.CE)("div",U,[(0,r.Lk)("div",X,[(0,r.bF)(i,{to:"/",class:"nav-item"},{default:(0,r.k6)((()=>o[2]||(o[2]=[(0,r.eW)("首页")]))),_:1}),(0,r.bF)(i,{to:"/subscribe",class:"nav-item active"},{default:(0,r.k6)((()=>o[3]||(o[3]=[(0,r.eW)("物品订阅")]))),_:1})]),(0,r.Lk)("div",A,[o[7]||(o[7]=(0,r.Lk)("h2",{class:"page-title"},"物品订阅",-1)),(0,r.Lk)("div",T,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.subscriptionGroups,((t,a)=>((0,r.uX)(),(0,r.CE)("div",{key:a,class:"group"},[(0,r.Lk)("div",V,[(0,r.Lk)("div",j,[(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":e=>t.worldSearch=e,class:"input-field",placeholder:"请选择区服",onInput:o=>e.searchWorlds(a),onFocus:o=>e.showWorldDropdown(a),onBlur:o=>e.hideDropdown("world",a)},null,40,M),[[s.Jo,t.worldSearch]]),t.showWorldDropdown&&t.worldResults.length?((0,r.uX)(),(0,r.CE)("div",O,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(t.worldResults,(o=>((0,r.uX)(),(0,r.CE)("div",{key:o.id,class:"dropdown-item",onMousedown:t=>e.selectWorld(a,o)},(0,m.v_)(o.name),41,J)))),128))])):(0,r.Q3)("",!0)]),(0,r.Lk)("div",P,[(0,r.Lk)("div",x,[(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":e=>t.items[0].nameSearch=e,class:"input-field",placeholder:"物品名称",onInput:o=>e.searchItems(a,0),onFocus:o=>e.showItemDropdown(a,0),onBlur:o=>e.hideDropdown("item",a,0)},null,40,K),[[s.Jo,t.items[0].nameSearch]]),t.items[0].showDropdown&&t.items[0].searchResults.length?((0,r.uX)(),(0,r.CE)("div",q,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(t.items[0].searchResults,(o=>((0,r.uX)(),(0,r.CE)("div",{key:o.id,class:"dropdown-item",onMousedown:t=>e.selectItem(a,0,o)},(0,m.v_)(o.name),41,z)))),128))])):(0,r.Q3)("",!0),(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":e=>t.items[0].threshold=e,class:"input-field threshold",type:"number",placeholder:"价格阈值"},null,8,B),[[s.Jo,t.items[0].threshold]]),(0,r.Lk)("button",{class:"delete-button",onClick:o=>e.deleteItem(a,0)},"×",8,$)])])]),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(t.items.slice(1),((t,n)=>((0,r.uX)(),(0,r.CE)("div",{key:n,class:"input-row"},[o[4]||(o[4]=(0,r.Lk)("div",{class:"empty-field"},null,-1)),(0,r.Lk)("div",N,[(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":e=>t.nameSearch=e,class:"input-field",placeholder:"物品名称",onInput:o=>e.searchItems(a,n+1),onFocus:o=>e.showItemDropdown(a,n+1),onBlur:o=>e.hideDropdown("item",a,n+1)},null,40,G),[[s.Jo,t.nameSearch]]),t.showDropdown&&t.searchResults.length?((0,r.uX)(),(0,r.CE)("div",Q,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(t.searchResults,(o=>((0,r.uX)(),(0,r.CE)("div",{key:o.id,class:"dropdown-item",onMousedown:t=>e.selectItem(a,n+1,o)},(0,m.v_)(o.name),41,H)))),128))])):(0,r.Q3)("",!0)]),(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":e=>t.threshold=e,class:"input-field",type:"number",placeholder:"价格阈值"},null,8,Y),[[s.Jo,t.threshold]]),(0,r.Lk)("button",{class:"delete-button",onClick:o=>e.deleteItem(a,n+1)},"×",8,Z)])))),128)),(0,r.Lk)("button",{class:"add-item-button",onClick:o=>e.addItem(a)},o[5]||(o[5]=[(0,r.Lk)("span",{class:"plus-icon"},"+",-1)]),8,ee)])))),128)),(0,r.Lk)("div",oe,[(0,r.Lk)("button",{class:"add-world-button",onClick:o[0]||(o[0]=(...o)=>e.addServerGroup&&e.addServerGroup(...o))},o[6]||(o[6]=[(0,r.Lk)("span",{class:"plus-icon"},"+",-1)]))]),(0,r.Lk)("div",te,[(0,r.Lk)("button",{class:"submit-button",onClick:o[1]||(o[1]=(...o)=>e.handleSubmit&&e.handleSubmit(...o))},"保存订阅")])])])])}var re=t(144);function ae(e,o){let t;return(...s)=>{t&&window.clearTimeout(t),t=window.setTimeout((()=>e(...s)),o)}}const ne=(0,r.pM)({name:"Subscribe",setup(){const e=(0,re.KR)([{worldSearch:"",showWorldDropdown:!1,worldResults:[],items:[{nameSearch:"",threshold:0,showDropdown:!1,searchResults:[]}]}]),o=async o=>{try{const t=await D.get("/ff14/world/search?name=");e.value[o].worldResults=t.data}catch(t){console.error("获取区服列表失败:",t)}},t=ae((async t=>{const s=e.value[t].worldSearch;if(s)try{const o=await D.get(`/ff14/world/search?name=${s}`);e.value[t].worldResults=o.data}catch(r){console.error("搜索区服失败:",r)}else await o(t)}),300),s=ae((async(o,t)=>{const s=e.value[o].items[t].nameSearch;try{const r=await D.get(`/ff14/item/search?name=${s}`);e.value[o].items[t].searchResults=r.data}catch(r){console.error("搜索物品失败:",r)}}),300),a=async t=>{e.value[t].showWorldDropdown=!0,await o(t)},n=async(o,t)=>{e.value[o].items[t].showDropdown=!0},l=(o,t,s)=>{setTimeout((()=>{"world"===o?e.value[t].showWorldDropdown=!1:void 0!==s&&(e.value[t].items[s].showDropdown=!1)}),200)},i=(o,t)=>{const s=e.value[o];s.worldId=t.id,s.world=t.name,s.worldSearch=t.name,s.showWorldDropdown=!1},u=(o,t,s)=>{const r=e.value[o].items[t];r.id=s.id,r.name=s.name,r.nameSearch=s.name,r.showDropdown=!1},d=()=>{e.value.push({worldSearch:"",showWorldDropdown:!1,worldResults:[],items:[{nameSearch:"",threshold:0,showDropdown:!1,searchResults:[]}]})},c=o=>{e.value[o].items.push({nameSearch:"",threshold:0,showDropdown:!1,searchResults:[]})},m=(o,t)=>{const s=e.value[o];1===s.items.length?e.value.splice(o,1):s.items.splice(t,1)},p=async()=>{try{const o=await D.get("/ff14/subscribe"),t=o.data;e.value=t.map((e=>({worldId:e.world.id,world:e.world.name,worldSearch:e.world.name,showWorldDropdown:!1,worldResults:[],items:e.items.map((e=>({id:e.item.id,name:e.item.name,nameSearch:e.item.name,threshold:e.notifyThreshold,showDropdown:!1,searchResults:[]})))}))),0===e.value.length&&e.value.push({worldSearch:"",showWorldDropdown:!1,worldResults:[],items:[{nameSearch:"",threshold:0,showDropdown:!1,searchResults:[]}]})}catch(o){console.error("获取订阅信息失败:",o),e.value=[{worldSearch:"",showWorldDropdown:!1,worldResults:[],items:[{nameSearch:"",threshold:0,showDropdown:!1,searchResults:[]}]}]}},h=async()=>{try{const o=e.value.filter((e=>e.worldId&&e.items.length>0)).map((e=>({world:{id:e.worldId},items:e.items.filter((e=>e.id)).map((e=>{const o={item:{id:e.id}};return e.threshold&&(o.notifyThreshold=e.threshold),o}))})));if(0===o.length)return void alert("请至少添加一个有效的订阅项");const t=o.find((e=>0===e.items.length));if(t)return void alert("每个区服至少需要订阅一个物品");await D.post("/ff14/subscribe",o),alert("保存成功"),await p()}catch(o){console.error("保存订阅失败:",o),alert(o.response?.data?.message||"保存失败，请重试")}};return(0,r.sV)((()=>{p()})),{subscriptionGroups:e,searchWorlds:t,searchItems:s,showWorldDropdown:a,showItemDropdown:n,hideDropdown:l,selectWorld:i,selectItem:u,addServerGroup:d,addItem:c,deleteItem:m,fetchSubscriptions:p,handleSubmit:h}}}),le=(0,i.A)(ne,[["render",se],["__scopeId","data-v-4f5a0b64"]]),ie=le,ue={class:"login-container"},de={class:"nav-bar"},ce={class:"content"},me={class:"login-box"},pe={class:"form-group"},he={class:"form-group"},ge={class:"form-footer"};function we(e,o,t,a,n,l){const i=(0,r.g2)("router-link");return(0,r.uX)(),(0,r.CE)("div",ue,[(0,r.Lk)("div",de,[(0,r.bF)(i,{to:"/",class:"nav-item"},{default:(0,r.k6)((()=>o[3]||(o[3]=[(0,r.eW)("首页")]))),_:1}),(0,r.bF)(i,{to:"/subscribe",class:"nav-item"},{default:(0,r.k6)((()=>o[4]||(o[4]=[(0,r.eW)("物品订阅")]))),_:1})]),(0,r.Lk)("div",ce,[(0,r.Lk)("div",me,[o[7]||(o[7]=(0,r.Lk)("h1",{class:"title"},"登录",-1)),(0,r.Lk)("form",{onSubmit:o[2]||(o[2]=(0,s.D$)(((...o)=>e.handleLogin&&e.handleLogin(...o)),["prevent"])),class:"login-form"},[(0,r.Lk)("div",pe,[(0,r.bo)((0,r.Lk)("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=o=>e.loginForm.userAccount=o),class:"input-field",placeholder:"请输入账户名/邮箱",required:""},null,512),[[s.Jo,e.loginForm.userAccount]])]),(0,r.Lk)("div",he,[(0,r.bo)((0,r.Lk)("input",{type:"password","onUpdate:modelValue":o[1]||(o[1]=o=>e.loginForm.password=o),class:"input-field",placeholder:"请输入密码",required:""},null,512),[[s.Jo,e.loginForm.password]])]),o[6]||(o[6]=(0,r.Lk)("div",{class:"form-group"},[(0,r.Lk)("button",{type:"submit",class:"login-btn"},"登录")],-1)),(0,r.Lk)("div",ge,[(0,r.bF)(i,{to:"/register",class:"register-link"},{default:(0,r.k6)((()=>o[5]||(o[5]=[(0,r.eW)("没有账号？立即注册")]))),_:1})])],32)])])])}const ve=(0,r.pM)({name:"LoginPage",setup(){const e=(0,c.rd)(),o=(0,y.Pj)(),t=(0,re.KR)({userAccount:"",password:""}),s=async()=>{try{const s=await D.post("/ff14/user/login",t.value);console.log("Login response:",s.data);const{tokenValue:r,userId:a}=s.data;if(!r)throw new Error("登录返回的数据格式不正确");o.commit("auth/setToken",r),o.commit("auth/setLoggedIn",!0);const n=await D.get("/ff14/user/info");console.log("User info response:",n.data);const l=n.data;l&&o.commit("auth/setUser",{userName:l.userName,email:l.email}),e.push("/")}catch(s){console.error("登录失败:",s);const e=s.response?.data?.message||"登录失败，请重试";alert(e)}};return{loginForm:t,handleLogin:s}}}),ke=(0,i.A)(ve,[["render",we],["__scopeId","data-v-a8d55a9e"]]),fe=ke,be={class:"register-container"},Le={class:"nav-bar"},ye={class:"content"},Ie={class:"register-box"},Se={class:"form-group"},Ce={class:"form-group"},Re={class:"form-group"},_e={class:"form-group"},De={class:"form-footer"};function Fe(e,o,t,a,n,l){const i=(0,r.g2)("router-link");return(0,r.uX)(),(0,r.CE)("div",be,[(0,r.Lk)("div",Le,[(0,r.bF)(i,{to:"/",class:"nav-item"},{default:(0,r.k6)((()=>o[5]||(o[5]=[(0,r.eW)("首页")]))),_:1}),(0,r.bF)(i,{to:"/subscribe",class:"nav-item"},{default:(0,r.k6)((()=>o[6]||(o[6]=[(0,r.eW)("物品订阅")]))),_:1})]),(0,r.Lk)("div",ye,[(0,r.Lk)("div",Ie,[o[9]||(o[9]=(0,r.Lk)("h1",{class:"title"},"用户注册",-1)),(0,r.Lk)("form",{onSubmit:o[4]||(o[4]=(0,s.D$)(((...o)=>e.handleRegister&&e.handleRegister(...o)),["prevent"])),class:"register-form"},[(0,r.Lk)("div",Se,[(0,r.bo)((0,r.Lk)("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=o=>e.user.userName=o),class:"input-field",placeholder:"请输入昵称",required:""},null,512),[[s.Jo,e.user.userName]])]),(0,r.Lk)("div",Ce,[(0,r.bo)((0,r.Lk)("input",{type:"text","onUpdate:modelValue":o[1]||(o[1]=o=>e.user.userAccount=o),class:"input-field",placeholder:"请输入账户名",required:""},null,512),[[s.Jo,e.user.userAccount]])]),(0,r.Lk)("div",Re,[(0,r.bo)((0,r.Lk)("input",{type:"email","onUpdate:modelValue":o[2]||(o[2]=o=>e.user.email=o),class:"input-field",placeholder:"请输入邮箱",required:""},null,512),[[s.Jo,e.user.email]])]),(0,r.Lk)("div",_e,[(0,r.bo)((0,r.Lk)("input",{type:"password","onUpdate:modelValue":o[3]||(o[3]=o=>e.user.password=o),class:"input-field",placeholder:"请输入密码",required:""},null,512),[[s.Jo,e.user.password]])]),o[8]||(o[8]=(0,r.Lk)("div",{class:"form-group"},[(0,r.Lk)("button",{type:"submit",class:"register-btn"},"注册")],-1)),(0,r.Lk)("div",De,[(0,r.bF)(i,{to:"/login",class:"login-link"},{default:(0,r.k6)((()=>o[7]||(o[7]=[(0,r.eW)("已有账号？立即登录")]))),_:1})])],32)])])])}const We=(0,r.pM)({name:"RegisterPage",setup(){const e=(0,c.rd)(),o=(0,re.KR)({userAccount:"",userName:"",email:"",password:""}),t=async()=>{try{await D.post("/ff14/user/register",o.value),alert("注册成功！"),e.push("/login")}catch(t){console.error("注册失败:",t),alert(t.response?.data?.message||"注册失败，请重试")}};return{user:o,handleRegister:t}}}),Ee=(0,i.A)(We,[["render",Fe],["__scopeId","data-v-01f6f4c4"]]),Ue=Ee,Xe=[{path:"/",name:"Home",component:E},{path:"/subscribe",name:"Subscribe",component:ie},{path:"/login",name:"Login",component:fe},{path:"/register",name:"Register",component:Ue}],Ae=(0,c.aE)({history:(0,c.LA)("/ff14_market/"),routes:Xe}),Te=Ae,Ve=(0,s.Ef)(d);Ve.use(R).use(Te).mount("#app")}},o={};function t(s){var r=o[s];if(void 0!==r)return r.exports;var a=o[s]={exports:{}};return e[s](a,a.exports,t),a.exports}t.m=e,(()=>{var e=[];t.O=(o,s,r,a)=>{if(!s){var n=1/0;for(d=0;d<e.length;d++){for(var[s,r,a]=e[d],l=!0,i=0;i<s.length;i++)(!1&a||n>=a)&&Object.keys(t.O).every((e=>t.O[e](s[i])))?s.splice(i--,1):(l=!1,a<n&&(n=a));if(l){e.splice(d--,1);var u=r();void 0!==u&&(o=u)}}return o}a=a||0;for(var d=e.length;d>0&&e[d-1][2]>a;d--)e[d]=e[d-1];e[d]=[s,r,a]}})(),(()=>{t.d=(e,o)=>{for(var s in o)t.o(o,s)&&!t.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:o[s]})}})(),(()=>{t.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()})(),(()=>{t.o=(e,o)=>Object.prototype.hasOwnProperty.call(e,o)})(),(()=>{t.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}})(),(()=>{var e={524:0};t.O.j=o=>0===e[o];var o=(o,s)=>{var r,a,[n,l,i]=s,u=0;if(n.some((o=>0!==e[o]))){for(r in l)t.o(l,r)&&(t.m[r]=l[r]);if(i)var d=i(t)}for(o&&o(s);u<n.length;u++)a=n[u],t.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return t.O(d)},s=self["webpackChunkff14_market_subscribe_frontend"]=self["webpackChunkff14_market_subscribe_frontend"]||[];s.forEach(o.bind(null,0)),s.push=o.bind(null,s.push.bind(s))})();var s=t.O(void 0,[504],(()=>t(104)));s=t.O(s)})();